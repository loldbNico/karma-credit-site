<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Karma Credit â€“ Apply for a Loan</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { background: #09061c; color: #e5e2e4; font-family: 'Montserrat', Arial, sans-serif;}
    .card { background: linear-gradient(120deg, #0c0a0f 0%, #160f3d 100%);
            border: 1.7px solid #4b4181; border-radius: 1.15rem; margin-bottom: 2.1rem; }
    .gold { color: #8c84ac; }
    .menu-btn { position: fixed; top: 18px; left: 28px; z-index: 50; }
    .logout-absolute { position: fixed; top: 18px; right: 28px; z-index: 50; }
  </style>
</head>
<body>
  <button id="menuBtn" class="menu-btn bg-[#16122f] p-2 rounded-full border border-[#4b4181] hover:bg-[#4b4181]">
    <svg width="30" height="30" fill="none" stroke="#e5e2e4" stroke-width="3" viewBox="0 0 24 24">
      <path stroke-linecap="round" d="M4 7h16M4 12h16M4 17h16"/></svg>
  </button>
  <button id="logoutBtn" class="btn-primary logout-absolute">Logout</button>
  <div class="w-full max-w-lg mx-auto mt-12 p-6">
    <a href="dashboard.html">
      <img src="https://i.postimg.cc/KcLVGFWY/logo6.png" class="logo-img w-20 h-20 rounded-full mx-auto mb-2"/>
      <img src="https://i.postimg.cc/QtFmLjWh/logo8.png" class="title-img max-w-xs mx-auto mb-6"/>
    </a>
    <div class="card p-7">
      <h1 class="text-2xl gold font-bold mb-4">Apply for a Loan</h1>
      <form id="loanRequestForm" class="space-y-5">
        <div>
          <label class="block mb-1 text-sm gold">Loan Amount ($)</label>
          <input type="number" id="loanAmount" class="w-full px-4 py-2 rounded bg-[#1a1a2b]" required>
        </div>
        <div>
          <label class="block mb-1 text-sm gold">Loan Reason / Notes</label>
          <textarea id="loanNotes" class="w-full px-4 py-2 rounded bg-[#1a1a2b]" rows="3"></textarea>
        </div>
        <button type="submit" class="btn-primary w-full mt-2">Submit Loan Request</button>
        <div id="loanRequestMsg" class="mt-2 text-center"></div>
      </form>
    </div>
    <a href="dashboard.html" class="text-blue-300 hover:underline">&larr; Back to Summary</a>
  </div>
  <script>
    const db = supabase.createClient(
      "https://nxgivpbbuwbzjsfbhlzt.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54Z2l2cGJidXdiempzZmJobHp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3ODA2ODYsImV4cCI6MjA2NDM1NjY4Nn0.7Hrn29OfpNGLyOy3tASiuWX6lsWQ3t1mrLWBb2K_E7E"
    );
    const user = JSON.parse(localStorage.getItem("karmaUser")||"{}");
    if (!user.id) window.location.href = "index.html";

    document.getElementById("loanRequestForm").onsubmit = async function(e) {
      e.preventDefault();
      const amt = +document.getElementById("loanAmount").value;
      const notes = document.getElementById("loanNotes").value;
      // Insert into 'loan_requests' (create this table if needed)
      const { error } = await db.from("loan_requests").insert({
        user_id: user.id, requested_amount: amt, notes: notes, status: 'Pending', created_at: new Date().toISOString()
      });
      if (!error) {
        document.getElementById("loanRequestMsg").textContent = "Request submitted!";
        document.getElementById("loanRequestMsg").className = "text-green-400 mt-2";
      } else {
        document.getElementById("loanRequestMsg").textContent = "Failed to submit!";
        document.getElementById("loanRequestMsg").className = "text-pink-300 mt-2";
      }
    };
    document.getElementById('logoutBtn').onclick = function() {
      localStorage.removeItem("karmaUser");
      window.location.href = "index.html";
    };
  </script>
</body>
</html>
